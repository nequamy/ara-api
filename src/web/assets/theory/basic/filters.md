# Фильтры, доступные в INAV

**Фильтр в inav** - настройка для подавления нежелательных частот электрического сигнала (шумов). 

**Характеристики фильтров:**
* _Передаточная функция_
* _Амплитудно-частотная характеристика_

График, демонстрирующий разницу величин амплитуд выходного и входного сигналов во всем диапазоне воспроизводимых частот
* _Полоса пропускания_

Диапазон частот, в пределах которого АЧХ достаточно равномерна для передачи сигнала
* _Полоса заграждения_

Частотная область затухания
* _Резонансная частота_ 

Частота, на которой коэффициент передачи фильтра имеет максимальное значение (для полосового фильтра) или минимальное значение (для заграждающего фильтра)
* _Частота среза_ 

Частота, после которой идет фронт (спад) с полосы пропускания на полосу заграждения. В INAV `cutoff`
* _Добротность Q_

Параметр фильтра, определяющий ширину резонанса. В INAV `Q factor`


## Виды фильтров и их принцип работы


### Notch-filter/режекторный фильтр
Notch-filter - он же режекторный и заградительный.

**Принцип работы:** фильтр ***не пропускает*** колебания определенной полосы частот и ***пропускает*** все, выходящие за пределы.

***dynamic_notch_filter*** улавливает изменения в частоте пика шума и фиксирует на нём фильтр

### LPF (Low-pass filter)/фильтр низких частот
Low-pass filter - фильтр низких частот

**Принцип работы:** фильтр ***не пропускает*** все частоты выше заданной и ***пропускает*** все ниже. 

### RPM-filter (rotations per minute)/фильтр шумов мотора

Relations per minute filter - фильтр шумов от мотора.

**Принцип работы:** алгоритм отслеживает скорость вращения двигателей, после чего устанавливает набор режекторных фильтров на этой частоте

## Особенности фильтров

**Что такое порядки?**

**Порядок фильтра** - параметр, характеризующий крутизну среза. Чем выше порядок, тем более крутой срез у фильтра.


Здесь необходимо подробно разобрать, что такое срез и полоса заграждения, а также как они влияют на действие фильтра. 

**Полоса заграждения** - это переходная зона между частотами ***полосы подавления*** и ***полосы пропускания***. Так как ничто в мире не идеально, фильтры имеют не перпендикулярный срез по заданной частоте. Из-за этого на границах диапазона существуют зоны, в которых подавляются не все частоты входного сигнала выше или ниже частоты среза. Это важно учитывать при установке фильтра, так как часть гармоник шума может попасть в полосу заграждения и не отфильтроваться. Чем больше крутизна среза, тем меньше полоса заграждения.

Фильтры высоких порядков склонны к осциллированию.

Поменять порядок фильтра можно с помощью параметров `dterm_lpf_type`, `acc_lpf_type`, для D-компоненты и акселерометра, соответственно.

## Установка фильтров в INAV

Установка фильтров в INAV для гироскопа (GYRO) доступна во вкладке PID Tuning -> Filters


Выбор состоит из:

1. Dynamic gyro LPF - динамический фильтр нижних частот для гироскопа, по умолчанию 60 Гц


2. Matrix filters - комплекс notch-фильтров для гироскопа


**Принцип работы:** алгоритм устанавливает стандартный notch-фильтр, но сразу на несколько осей (с одной частотой)

Выбор фильтров:

* `2D` - 
* `3D_R` -
* `3D_P` -
* `3D_Y` -
* `3D_RP` -
* `3D_RY` - 
* `3D_PY` -
* `3D` -

1. Unicorn filter - фильтр Калмана

Принцип работы:
4. D-term LPF - фильтр нижних частот для D-компоненты

5. Gyro RPM filter - фильтр оборотов мотора для гироскопа

6. Acc LPF - фильтр нижних частот для акселерометра

Доступен в CLI через настройку `set acc_lpf_hz`
7. Acc notch filter - режекторный фильтр для акселерометра

Доступен в CLI через настройку `set acc_notch_hz`
